<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OpenBooks - Historische Bouwkundige Literatuur</title>
  <meta name="description" content="Gedigitaliseerde oude bouwkundige boeken - vrij toegankelijk voor ingenieurs, architecten en bouwmeesters.">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ“š</text></svg>">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'DM Sans', sans-serif; background: #0F0C08; color: #F5E6D3; overflow-x: hidden; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes spin { to { transform: rotate(360deg); } }
    @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: rgba(139, 115, 85, 0.1); }
    ::-webkit-scrollbar-thumb { background: rgba(139, 115, 85, 0.3); border-radius: 4px; }
    @media (max-width: 768px) {
      .header-inner { flex-direction: column; gap: 1rem; padding: 1rem !important; }
      .search-bar { width: 100% !important; max-width: 100% !important; }
      .hero-stats { flex-direction: column; gap: 1.5rem !important; }
      .books-grid { padding: 1rem !important; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)) !important; }
      .category-filter { padding: 0 1rem !important; }
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;
    const GITHUB_RAW = "https://raw.githubusercontent.com/OpenAEC-Foundation/OpenBooks/main";
    const GITHUB_API = "https://api.github.com/repos/OpenAEC-Foundation/OpenBooks/contents";

    // Alle 22 boeken met omslagafbeeldingen
    const booksData = [
      // Gugel
      { id: 1, title: "Architectonische Vormenleer", subtitle: "Platen", author: "Prof. E.H. Gugel", year: "1880", category: "Architectuur", folder: "Prof. E.H. Gugel Architectonische Vormenleer 1880", pages: 243, coverColor: "#8B7355", coverImage: "OpeningImage.JPG" },
      { id: 2, title: "Architectonische Vormenleer", subtitle: "Beschrijving", author: "Prof. E.H. Gugel", year: "1880", category: "Architectuur", folder: "Prof. E.H. Gugel Architectonische Vormenleer 1880 beschrijving", pages: 330, coverColor: "#7B6345", coverImage: "OpeningImage.JPG" },

      // Wattjes serie
      { id: 10, title: "Constructie van Gebouwen Deel 1", subtitle: "Muren en schoorsteenen", author: "Prof. J.G. Wattjes", year: "1920", category: "Constructie", folder: "Prof. J.G. Wattjes Deel 1 Muren en aangebouwde schoorsteenen", pages: 148, coverColor: "#4A5568", coverImage: "OpeningImageWattjes1.JPG" },
      { id: 11, title: "Constructie van Gebouwen Deel 2", subtitle: "Vrijstaande schoorsteenen, haarden", author: "Prof. J.G. Wattjes", year: "1920", category: "Constructie", folder: "Prof. J.G. Wattjes Deel 2 Vrijstaande schoorsteenen haarden en smidsen", pages: 98, coverColor: "#4A5568", coverImage: "OpeningImage2.JPG" },
      { id: 12, title: "Constructie van Gebouwen Deel 3", subtitle: "Funderingen en Kelders", author: "Prof. J.G. Wattjes", year: "1920", category: "Constructie", folder: "Prof. J.G. Wattjes Deel 3 Funderingen en Kelders Rioleeringen", pages: 232, coverColor: "#4A5568", coverImage: "OpeningImageWattjes3.JPG" },
      { id: 13, title: "Constructie van Gebouwen Deel 4", subtitle: "Ramen, Deuren, Kozijnen", author: "Prof. J.G. Wattjes", year: "1920", category: "Constructie", folder: "Prof. J.G. Wattjes Deel 4 Ramen Deuren Kozijnen", pages: 205, coverColor: "#4A5568", coverImage: "OpeningImageWattjes4.jpg" },
      { id: 14, title: "Constructie van Gebouwen Deel 5", subtitle: "Betimmeringen en leidingen", author: "Prof. J.G. Wattjes", year: "1920", category: "Constructie", folder: "Prof. J.G. Wattjes Deel 5 Binnen en buitenbetimmeringen leidingen", pages: 118, coverColor: "#4A5568", coverImage: "OpeningImageWattjes5.jpg" },
      { id: 15, title: "Constructie van Gebouwen Deel 6", subtitle: "Vloeren en skeletbouw", author: "Prof. J.G. Wattjes", year: "1920", category: "Constructie", folder: "Prof. J.G. Wattjes Deel 6 Vloeren, binten, kolommen, plafonds en skeletbouw", pages: 157, coverColor: "#4A5568", coverImage: "OpeningImageWattjes6.jpg" },
      { id: 16, title: "Constructie van Gebouwen Deel 7", subtitle: "Gewelven", author: "Prof. J.G. Wattjes", year: "1920", category: "Constructie", folder: "Prof. J.G. Wattjes Deel 7 Gewelven van steen, hout, gewapend-beton en glas", pages: 90, coverColor: "#4A5568", coverImage: "OpeningImageWattjes7.JPG" },
      { id: 17, title: "Constructie van Gebouwen Deel 8", subtitle: "Trappen en liften", author: "Prof. J.G. Wattjes", year: "1920", category: "Constructie", folder: "Prof. J.G. Wattjes Deel 8 Trappen van hout, ijzer, steen en gewapend beton roltrappen liften", pages: 112, coverColor: "#4A5568", coverImage: "OpeningImageWattjes8.jpg" },
      { id: 18, title: "Constructie van Gebouwen Deel 9", subtitle: "Dakconstructies", author: "Prof. J.G. Wattjes", year: "1920", category: "Constructie", folder: "Prof. J.G. Wattjes Deel 9 Eenvoudige dakconstructies en dakbedekkingen", pages: 181, coverColor: "#4A5568", coverImage: "OpeningImageWattjes9.jpg" },
      { id: 19, title: "Constructie van Gebouwen Deel 10", subtitle: "Kapconstructies en koepeldaken", author: "Prof. J.G. Wattjes", year: "1920", category: "Constructie", folder: "Prof. J.G. Wattjes Deel 10 Moderne kapconstructies toren- en koepeldaken", pages: 178, coverColor: "#4A5568", coverImage: "OpeningImageWattjes9.jpg" },

      // Vandepitte
      { id: 20, title: "Berekening van Constructies I", author: "Prof. D. Vandepitte", year: "1960", category: "Berekeningen", folder: "Prof. D. Vandepitte Berekening van Constructies Boekdeel I", pages: 597, coverColor: "#2D3748", coverImage: "OpeningImagePitte.jpg" },
      { id: 21, title: "Berekening van Constructies II", author: "Prof. D. Vandepitte", year: "1960", category: "Berekeningen", folder: "Prof. D. Vandepitte Berekening van Constructies Boekdeel II", pages: 694, coverColor: "#2D3748", coverImage: "OpeningImagePitte.jpg" },
      { id: 22, title: "Berekening van Constructies III", author: "Prof. D. Vandepitte", year: "1960", category: "Berekeningen", folder: "Prof. D. Vandepitte Berekening van Constructies Boekdeel III", pages: 715, coverColor: "#2D3748", coverImage: "OpeningImagePitte.jpg" },

      // Andere boeken
      { id: 30, title: "Staalconstructies", subtitle: "Theorie, berekening en uitvoering", author: "Ir. A.P. Potma & Ir. J.E. de Vries", year: "1965", category: "Staal", folder: "Ir A.P. Potma en Ir J.E. de Vries Staalconstructies, theorie, berekening en uitvoering", pages: 179, coverColor: "#1A365D", coverImage: "OpeningImagePotma.jpg" },
      { id: 31, title: "Houtconstructies Handboek", author: "L. Zwiers", year: "1950", category: "Hout", folder: "L. Zwiers Houtconstructies Handboek", pages: 305, coverColor: "#744210", coverImage: "OpeningImageZwiers.png" },
      { id: 32, title: "Bernoullis Vademecum", author: "Bernoulli", year: "1950", category: "Berekeningen", folder: "Bernoullis Vademecum", pages: 349, coverColor: "#553C9A", coverImage: "OpeningImagePitte.jpg" },

      // Voorschriften
      { id: 40, title: "G.B.V. Gewapend Beton Voorschriften", author: "Overheid", year: "1950", category: "Voorschriften", folder: "1950 G.B.V. Gewapend Beton Voorschriften", pages: 44, coverColor: "#2F855A", coverImage: "OpeningImage3.JPG" },
      { id: 41, title: "VB Voorschriften Beton", author: "Overheid", year: "1974", category: "Voorschriften", folder: "1974 VB Voorschriften Beton", pages: 264, coverColor: "#276749", coverImage: "OpeningImage3.JPG" },

      // Klassiek
      { id: 50, title: "Cort onderwys van de Vyf Colommen", author: "Symon Bosboom", year: "1650", category: "Klassiek", folder: "Stadssteenhouwer Symon Bosboom Cort onderwys VANDE VYF COLOMMEN", pages: 52, coverColor: "#6B4423", coverImage: "OpeningImageBosboom1.jpg" },
      { id: 51, title: "Paneeldeuren", author: "Onbekend", year: "1900", category: "Klassiek", folder: "Paneeldeuren", pages: 25, coverColor: "#5D4E37", coverImage: "OpeningImagePaneeldeur.png" },
    ];

    // Cache voor bestandslijsten (localStorage)
    const fileCache = {
      get: (folder) => {
        try {
          const cached = localStorage.getItem(`openbooks_${folder}`);
          if (cached) {
            const { files, timestamp } = JSON.parse(cached);
            if (Date.now() - timestamp < 24 * 60 * 60 * 1000) return files;
          }
        } catch (e) {}
        return null;
      },
      set: (folder, files) => {
        try {
          localStorage.setItem(`openbooks_${folder}`, JSON.stringify({ files, timestamp: Date.now() }));
        } catch (e) {}
      }
    };

    // Haal bestanden op van GitHub API
    const fetchFiles = async (folder) => {
      const cached = fileCache.get(folder);
      if (cached) return cached;

      try {
        const response = await fetch(`${GITHUB_API}/${encodeURIComponent(folder)}`);
        if (!response.ok) throw new Error('API error');
        const data = await response.json();
        const files = data
          .filter(f => f.type === 'file' && /\.(jpg|jpeg|png|gif)$/i.test(f.name))
          .sort((a, b) => a.name.localeCompare(b.name, undefined, { numeric: true }))
          .map(f => ({
            name: f.name,
            url: `${GITHUB_RAW}/${encodeURIComponent(folder)}/${encodeURIComponent(f.name)}`
          }));
        fileCache.set(folder, files);
        return files;
      } catch (e) {
        console.error('Fetch error:', e);
        return [];
      }
    };

    // Download alle scans als ZIP
    const downloadAsZip = async (book, onProgress) => {
      onProgress(0);
      const files = await fetchFiles(book.folder);
      if (files.length === 0) {
        alert('Geen bestanden gevonden om te downloaden');
        onProgress(null);
        return;
      }

      const zip = new JSZip();
      const folderName = book.title.replace(/[^a-zA-Z0-9\s]/g, '').replace(/\s+/g, '_');
      const zipFolder = zip.folder(folderName);

      for (let i = 0; i < files.length; i++) {
        onProgress(Math.round((i / files.length) * 90));
        try {
          const response = await fetch(files[i].url);
          const blob = await response.blob();
          zipFolder.file(files[i].name, blob);
        } catch (e) {
          console.error(`Error downloading ${files[i].name}:`, e);
        }
      }

      onProgress(95);
      const content = await zip.generateAsync({ type: 'blob' });
      onProgress(100);

      const url = URL.createObjectURL(content);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${folderName}.zip`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);

      setTimeout(() => onProgress(null), 1000);
    };

    // Book Viewer Component
    const BookViewer = ({ book, onClose }) => {
      const [files, setFiles] = useState([]);
      const [loading, setLoading] = useState(true);
      const [currentPage, setCurrentPage] = useState(0);
      const [imageLoaded, setImageLoaded] = useState(false);
      const [downloadProgress, setDownloadProgress] = useState(null);
      const [zoom, setZoom] = useState(1);
      const [position, setPosition] = useState({ x: 0, y: 0 });
      const [isDragging, setIsDragging] = useState(false);
      const [dragStart, setDragStart] = useState({ x: 0, y: 0 });
      const containerRef = React.useRef(null);

      const zoomLevels = [0.5, 0.75, 1, 1.25, 1.5, 2, 3];

      useEffect(() => {
        setLoading(true);
        fetchFiles(book.folder).then(f => { setFiles(f); setLoading(false); });
      }, [book.folder]);

      useEffect(() => {
        const handleKey = (e) => {
          if (e.key === 'Escape') onClose();
          if (e.key === 'ArrowRight') { setCurrentPage(p => Math.min(p + 1, files.length - 1)); resetZoom(); }
          if (e.key === 'ArrowLeft') { setCurrentPage(p => Math.max(p - 1, 0)); resetZoom(); }
          if (e.key === '+' || e.key === '=') zoomIn();
          if (e.key === '-') zoomOut();
          if (e.key === '0') resetZoom();
        };
        window.addEventListener('keydown', handleKey);
        return () => window.removeEventListener('keydown', handleKey);
      }, [files.length, onClose]);

      useEffect(() => { setImageLoaded(false); resetZoom(); }, [currentPage]);

      const resetZoom = () => { setZoom(1); setPosition({ x: 0, y: 0 }); };
      const zoomIn = () => { const idx = zoomLevels.findIndex(z => z >= zoom); setZoom(zoomLevels[Math.min(idx + 1, zoomLevels.length - 1)]); };
      const zoomOut = () => { const idx = zoomLevels.findIndex(z => z >= zoom); setZoom(zoomLevels[Math.max(idx - 1, 0)]); setPosition({ x: 0, y: 0 }); };

      const handleWheel = (e) => {
        e.preventDefault();
        if (e.deltaY < 0) zoomIn();
        else zoomOut();
      };

      const handleMouseDown = (e) => {
        if (zoom > 1) {
          setIsDragging(true);
          setDragStart({ x: e.clientX - position.x, y: e.clientY - position.y });
        }
      };

      const handleMouseMove = (e) => {
        if (isDragging && zoom > 1) {
          setPosition({ x: e.clientX - dragStart.x, y: e.clientY - dragStart.y });
        }
      };

      const handleMouseUp = () => setIsDragging(false);

      return (
        <div style={{ position: 'fixed', inset: 0, background: 'rgba(15,12,8,0.98)', zIndex: 100, display: 'flex', flexDirection: 'column', animation: 'fadeIn 0.3s ease' }}>
          {/* Header */}
          <header style={{ padding: '1rem 2rem', display: 'flex', justifyContent: 'space-between', alignItems: 'center', borderBottom: '1px solid rgba(139,115,85,0.3)', background: 'linear-gradient(180deg, rgba(30,25,18,0.9) 0%, transparent 100%)', flexWrap: 'wrap', gap: '1rem' }}>
            <div>
              <h2 style={{ fontFamily: 'Playfair Display, serif', color: '#F5E6D3', fontSize: '1.5rem' }}>{book.title}</h2>
              <p style={{ color: '#A89070', fontSize: '0.9rem' }}>{book.author} - {book.year}</p>
            </div>
            <div style={{ display: 'flex', gap: '0.75rem', alignItems: 'center', flexWrap: 'wrap' }}>
              {/* Zoom controls */}
              <div style={{ display: 'flex', alignItems: 'center', gap: '0.25rem', background: 'rgba(139,115,85,0.2)', borderRadius: '2rem', padding: '0.25rem', border: '1px solid rgba(139,115,85,0.3)' }}>
                <button onClick={zoomOut} style={{ width: '32px', height: '32px', background: 'transparent', border: 'none', color: '#F5E6D3', cursor: 'pointer', fontSize: '1.2rem', borderRadius: '50%' }}>-</button>
                <span style={{ color: '#A89070', fontSize: '0.8rem', minWidth: '45px', textAlign: 'center' }}>{Math.round(zoom * 100)}%</span>
                <button onClick={zoomIn} style={{ width: '32px', height: '32px', background: 'transparent', border: 'none', color: '#F5E6D3', cursor: 'pointer', fontSize: '1.2rem', borderRadius: '50%' }}>+</button>
                <button onClick={resetZoom} style={{ padding: '0.25rem 0.5rem', background: 'transparent', border: 'none', color: '#A89070', cursor: 'pointer', fontSize: '0.75rem' }}>Fit</button>
              </div>
              <button onClick={() => downloadAsZip(book, setDownloadProgress)} disabled={downloadProgress !== null}
                style={{ padding: '0.5rem 1rem', background: downloadProgress !== null ? 'rgba(139,115,85,0.1)' : 'rgba(46,125,50,0.3)', borderRadius: '2rem', border: '1px solid rgba(46,125,50,0.5)', color: '#A8C8A0', cursor: downloadProgress !== null ? 'default' : 'pointer', fontSize: '0.85rem', display: 'flex', alignItems: 'center', gap: '0.5rem', fontFamily: 'DM Sans, sans-serif' }}>
                {downloadProgress !== null ? `Downloaden... ${downloadProgress}%` : 'Download ZIP'}
              </button>
              <a href={`https://github.com/OpenAEC-Foundation/OpenBooks/tree/main/${encodeURIComponent(book.folder)}`} target="_blank" rel="noopener"
                 style={{ padding: '0.5rem 1rem', background: 'rgba(139,115,85,0.2)', borderRadius: '2rem', border: '1px solid rgba(139,115,85,0.3)', color: '#F5E6D3', textDecoration: 'none', fontSize: '0.85rem' }}>
                GitHub
              </a>
              <button onClick={onClose} style={{ background: 'rgba(139,115,85,0.2)', border: '1px solid rgba(139,115,85,0.3)', color: '#F5E6D3', padding: '0.5rem 1rem', borderRadius: '0.5rem', cursor: 'pointer', fontFamily: 'DM Sans, sans-serif' }}>Sluiten</button>
            </div>
          </header>

          {/* Main content */}
          <div style={{ flex: 1, display: 'flex', flexDirection: 'column', overflow: 'hidden' }}>
            {/* Thumbnail strip */}
            <div style={{ padding: '0.5rem 1rem', background: 'rgba(20,16,10,0.8)', borderBottom: '1px solid rgba(139,115,85,0.2)', overflowX: 'auto' }}>
              <div style={{ display: 'flex', gap: '0.5rem' }}>
                {files.slice(0, 50).map((f, i) => (
                  <button key={i} onClick={() => setCurrentPage(i)}
                    style={{ minWidth: '40px', height: '40px', background: currentPage === i ? '#8B7355' : 'rgba(139,115,85,0.2)', border: currentPage === i ? '2px solid #A89070' : '1px solid rgba(139,115,85,0.3)', borderRadius: '4px', color: '#F5E6D3', cursor: 'pointer', fontSize: '0.75rem', fontFamily: 'DM Sans, sans-serif' }}>
                    {i + 1}
                  </button>
                ))}
                {files.length > 50 && <span style={{ color: '#A89070', alignSelf: 'center', fontSize: '0.8rem', marginLeft: '0.5rem' }}>+{files.length - 50} meer</span>}
              </div>
            </div>

            {/* Image viewer */}
            <div ref={containerRef} onWheel={handleWheel} onMouseDown={handleMouseDown} onMouseMove={handleMouseMove} onMouseUp={handleMouseUp} onMouseLeave={handleMouseUp}
              style={{ flex: 1, display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '1rem', position: 'relative', overflow: 'hidden', cursor: zoom > 1 ? (isDragging ? 'grabbing' : 'grab') : 'default' }}>
              {loading ? (
                <div style={{ textAlign: 'center' }}>
                  <div style={{ width: '50px', height: '50px', border: '3px solid rgba(139,115,85,0.2)', borderTopColor: '#8B7355', borderRadius: '50%', animation: 'spin 1s linear infinite', margin: '0 auto' }} />
                  <p style={{ color: '#A89070', marginTop: '1rem' }}>Laden...</p>
                </div>
              ) : files.length > 0 ? (
                <>
                  <img src={files[currentPage]?.url} alt={files[currentPage]?.name}
                    onLoad={() => setImageLoaded(true)}
                    draggable={false}
                    style={{ maxWidth: zoom === 1 ? '100%' : 'none', maxHeight: zoom === 1 ? '100%' : 'none', width: zoom !== 1 ? `${zoom * 100}%` : 'auto', objectFit: 'contain', opacity: imageLoaded ? 1 : 0, transition: isDragging ? 'none' : 'opacity 0.3s, transform 0.2s', boxShadow: '0 4px 20px rgba(0,0,0,0.5)', transform: `translate(${position.x}px, ${position.y}px)`, userSelect: 'none' }} />
                  {!imageLoaded && <div style={{ position: 'absolute', width: '40px', height: '40px', border: '3px solid rgba(139,115,85,0.2)', borderTopColor: '#8B7355', borderRadius: '50%', animation: 'spin 1s linear infinite' }} />}

                  {/* Navigation arrows */}
                  <button onClick={(e) => { e.stopPropagation(); setCurrentPage(p => Math.max(0, p - 1)); resetZoom(); }} disabled={currentPage === 0}
                    style={{ position: 'absolute', left: '1rem', top: '50%', transform: 'translateY(-50%)', width: '48px', height: '48px', borderRadius: '50%', background: currentPage === 0 ? 'rgba(139,115,85,0.1)' : 'rgba(139,115,85,0.3)', border: 'none', cursor: currentPage === 0 ? 'default' : 'pointer', color: '#F5E6D3', fontSize: '1.5rem', zIndex: 10 }}>
                    &#8249;
                  </button>
                  <button onClick={(e) => { e.stopPropagation(); setCurrentPage(p => Math.min(files.length - 1, p + 1)); resetZoom(); }} disabled={currentPage === files.length - 1}
                    style={{ position: 'absolute', right: '1rem', top: '50%', transform: 'translateY(-50%)', width: '48px', height: '48px', borderRadius: '50%', background: currentPage === files.length - 1 ? 'rgba(139,115,85,0.1)' : 'rgba(139,115,85,0.3)', border: 'none', cursor: currentPage === files.length - 1 ? 'default' : 'pointer', color: '#F5E6D3', fontSize: '1.5rem', zIndex: 10 }}>
                    &#8250;
                  </button>
                </>
              ) : (
                <div style={{ textAlign: 'center' }}>
                  <p style={{ color: '#A89070' }}>Geen bestanden gevonden</p>
                  <a href={`https://github.com/OpenAEC-Foundation/OpenBooks/tree/main/${encodeURIComponent(book.folder)}`} target="_blank" rel="noopener"
                     style={{ display: 'inline-block', marginTop: '1rem', padding: '0.5rem 1rem', background: '#8B7355', color: '#FFF', borderRadius: '4px', textDecoration: 'none' }}>
                    Bekijk op GitHub
                  </a>
                </div>
              )}
            </div>

            {/* Page info */}
            <div style={{ padding: '1rem', textAlign: 'center', borderTop: '1px solid rgba(139,115,85,0.2)' }}>
              <span style={{ fontFamily: 'Playfair Display, serif', color: '#6B5344' }}>
                Pagina {currentPage + 1} van {files.length}
              </span>
              {files[currentPage] && <div style={{ color: '#5A4A3A', fontSize: '0.75rem', marginTop: '0.25rem' }}>{files[currentPage].name}</div>}
            </div>
          </div>
        </div>
      );
    };

    // Book Card Component met cover images
    const BookCard = ({ book, index }) => {
      const [imageLoaded, setImageLoaded] = useState(false);
      const [imageError, setImageError] = useState(false);
      const [isHovered, setIsHovered] = useState(false);
      const [downloadProgress, setDownloadProgress] = useState(null);

      return (
        <div
          onMouseEnter={() => setIsHovered(true)}
          onMouseLeave={() => setIsHovered(false)}
          style={{
            background: 'linear-gradient(145deg, rgba(30,25,18,0.9) 0%, rgba(20,16,10,0.95) 100%)',
            borderRadius: '12px',
            overflow: 'hidden',
            transition: 'all 0.4s cubic-bezier(0.4, 0, 0.2, 1)',
            border: '1px solid rgba(139,115,85,0.2)',
            animation: `slideUp 0.6s ease ${index * 0.05}s both`,
            transform: isHovered ? 'translateY(-8px) scale(1.02)' : 'translateY(0) scale(1)',
            boxShadow: isHovered ? '0 20px 40px rgba(0,0,0,0.4), 0 0 0 1px rgba(139,115,85,0.3)' : 'none'
          }}
        >
          {/* Book Cover Visual */}
          <div onClick={() => book.onClick && book.onClick()} style={{
            height: '220px',
            background: `linear-gradient(135deg, ${book.coverColor} 0%, ${book.coverColor}dd 100%)`,
            position: 'relative',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            overflow: 'hidden',
            cursor: 'pointer'
          }}>
            {book.coverImage && !imageError && (
              <img
                src={`${GITHUB_RAW}/${book.coverImage}`}
                alt={book.title}
                onLoad={() => setImageLoaded(true)}
                onError={() => setImageError(true)}
                style={{
                  position: 'absolute',
                  inset: 0,
                  width: '100%',
                  height: '100%',
                  objectFit: 'cover',
                  objectPosition: 'center top',
                  opacity: imageLoaded ? 1 : 0,
                  transition: 'opacity 0.5s ease, transform 0.4s ease',
                  transform: isHovered ? 'scale(1.05)' : 'scale(1)'
                }}
              />
            )}
            <div style={{
              position: 'absolute',
              inset: 0,
              background: imageLoaded && !imageError
                ? 'linear-gradient(0deg, rgba(15,12,8,0.95) 0%, rgba(15,12,8,0.4) 40%, rgba(15,12,8,0.1) 70%, transparent 100%)'
                : 'none',
              zIndex: 2
            }} />
            <div style={{
              position: 'absolute',
              left: 0,
              top: 0,
              bottom: 0,
              width: '20px',
              background: 'linear-gradient(90deg, rgba(0,0,0,0.5) 0%, rgba(0,0,0,0.2) 50%, transparent 100%)',
              zIndex: 3
            }} />

            <div style={{
              position: 'absolute',
              bottom: 0,
              left: 0,
              right: 0,
              padding: '1.25rem',
              zIndex: 4
            }}>
              <h3 style={{
                fontFamily: 'Playfair Display, serif',
                color: '#FFF',
                fontSize: '1rem',
                fontWeight: 600,
                textShadow: '0 2px 8px rgba(0,0,0,0.8)',
                lineHeight: 1.3,
                margin: 0
              }}>
                {book.title}
              </h3>
              {book.subtitle && (
                <p style={{
                  fontFamily: 'DM Sans, sans-serif',
                  color: 'rgba(255,255,255,0.8)',
                  fontSize: '0.75rem',
                  marginTop: '0.4rem',
                  textShadow: '0 1px 4px rgba(0,0,0,0.8)'
                }}>
                  {book.subtitle}
                </p>
              )}
            </div>

            {!imageLoaded && !imageError && book.coverImage && (
              <div style={{ position: 'absolute', inset: 0, display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 1 }}>
                <div style={{ width: '32px', height: '32px', border: '3px solid rgba(245,230,211,0.2)', borderTopColor: '#F5E6D3', borderRadius: '50%', animation: 'spin 1s linear infinite' }} />
              </div>
            )}
          </div>

          <div style={{ padding: '1rem' }}>
            <p style={{ fontFamily: 'DM Sans, sans-serif', color: '#A89070', fontSize: '0.85rem', margin: '0 0 0.5rem' }}>
              {book.author}
            </p>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
              <span style={{ fontFamily: 'Playfair Display, serif', color: '#6B5344', fontSize: '0.9rem' }}>
                {book.year}
              </span>
              <span style={{ fontFamily: 'DM Sans, sans-serif', color: '#6B5344', fontSize: '0.75rem', background: 'rgba(139,115,85,0.15)', padding: '4px 10px', borderRadius: '12px' }}>
                {book.pages} pag.
              </span>
            </div>

            {/* Download button */}
            <button
              onClick={(e) => { e.stopPropagation(); downloadAsZip(book, setDownloadProgress); }}
              disabled={downloadProgress !== null}
              style={{
                width: '100%',
                marginTop: '0.75rem',
                padding: '0.6rem',
                background: downloadProgress !== null ? 'rgba(139,115,85,0.1)' : 'rgba(46,125,50,0.15)',
                border: '1px solid rgba(46,125,50,0.3)',
                borderRadius: '8px',
                color: '#A8C8A0',
                cursor: downloadProgress !== null ? 'default' : 'pointer',
                fontSize: '0.8rem',
                fontFamily: 'DM Sans, sans-serif',
                transition: 'all 0.2s'
              }}>
              {downloadProgress !== null ? `Downloaden... ${downloadProgress}%` : 'Download alle scans (ZIP)'}
            </button>
          </div>
        </div>
      );
    };

    // Main App
    function App() {
      const [selectedBook, setSelectedBook] = useState(null);
      const [search, setSearch] = useState('');
      const categories = ['Alle', 'Architectuur', 'Constructie', 'Berekeningen', 'Staal', 'Hout', 'Voorschriften', 'Klassiek'];

      // Lees categorie uit URL hash
      const getCategoryFromHash = () => {
        const hash = window.location.hash.slice(1).toLowerCase();
        if (!hash) return 'Alle';
        const found = categories.find(c => c.toLowerCase() === hash);
        return found || 'Alle';
      };

      const [category, setCategory] = useState(getCategoryFromHash);

      // Update URL hash bij categorie wijziging
      const handleCategoryChange = (cat) => {
        setCategory(cat);
        if (cat === 'Alle') {
          history.pushState(null, '', window.location.pathname);
        } else {
          history.pushState(null, '', `#${cat.toLowerCase()}`);
        }
      };

      // Luister naar browser back/forward
      useEffect(() => {
        const handleHashChange = () => setCategory(getCategoryFromHash());
        window.addEventListener('hashchange', handleHashChange);
        window.addEventListener('popstate', handleHashChange);
        return () => {
          window.removeEventListener('hashchange', handleHashChange);
          window.removeEventListener('popstate', handleHashChange);
        };
      }, []);

      const filteredBooks = booksData.filter(b => {
        const matchCat = category === 'Alle' || b.category === category;
        const matchSearch = b.title.toLowerCase().includes(search.toLowerCase()) || b.author.toLowerCase().includes(search.toLowerCase());
        return matchCat && matchSearch;
      });

      const totalPages = booksData.reduce((sum, b) => sum + b.pages, 0);

      return (
        <div style={{ minHeight: '100vh', background: 'linear-gradient(180deg, #0F0C08 0%, #1A1510 50%, #0F0C08 100%)' }}>
          {/* Header */}
          <header className="header-inner" style={{ padding: '1.5rem 2rem', display: 'flex', justifyContent: 'space-between', alignItems: 'center', borderBottom: '1px solid rgba(139,115,85,0.15)', position: 'sticky', top: 0, zIndex: 50, background: 'linear-gradient(180deg, rgba(15,12,8,0.98) 0%, rgba(15,12,8,0.9) 100%)', backdropFilter: 'blur(20px)' }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>
              <div style={{ width: '48px', height: '48px', background: 'linear-gradient(135deg, #8B7355 0%, #6B5344 100%)', borderRadius: '8px', display: 'flex', alignItems: 'center', justifyContent: 'center', boxShadow: '0 4px 12px rgba(139,115,85,0.3)' }}>
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#F5E6D3" strokeWidth="2">
                  <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                  <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                </svg>
              </div>
              <div>
                <h1 style={{ fontFamily: 'Playfair Display, serif', color: '#F5E6D3', fontSize: '1.5rem', fontWeight: 600 }}>OpenBooks</h1>
                <p style={{ color: '#6B5344', fontSize: '0.7rem', letterSpacing: '0.1em', textTransform: 'uppercase' }}>OpenAEC Foundation</p>
              </div>
            </div>
            <div className="search-bar" style={{ position: 'relative', width: '350px', maxWidth: '100%' }}>
              <input type="text" placeholder="Zoek in boeken..." value={search} onChange={(e) => setSearch(e.target.value)}
                style={{ width: '100%', padding: '0.75rem 1rem 0.75rem 2.75rem', background: 'rgba(139,115,85,0.1)', border: '1px solid rgba(139,115,85,0.2)', borderRadius: '12px', color: '#F5E6D3', fontFamily: 'DM Sans, sans-serif', fontSize: '0.9rem', outline: 'none' }} />
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#8B7355" strokeWidth="2" style={{ position: 'absolute', left: '0.875rem', top: '50%', transform: 'translateY(-50%)' }}>
                <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
              </svg>
            </div>
            <a href="https://github.com/OpenAEC-Foundation/OpenBooks" target="_blank" rel="noopener" style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', color: '#A89070', textDecoration: 'none', padding: '0.6rem 1rem', background: 'rgba(139,115,85,0.1)', borderRadius: '8px', border: '1px solid rgba(139,115,85,0.2)', fontSize: '0.9rem' }}>
              <svg width="18" height="18" viewBox="0 0 24 24" fill="#A89070"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
              GitHub
            </a>
          </header>

          {/* Hero */}
          <section style={{ padding: '3rem 2rem', textAlign: 'center', position: 'relative' }}>
            <div style={{ position: 'absolute', inset: 0, background: 'radial-gradient(ellipse at 20% 50%, rgba(139,115,85,0.08) 0%, transparent 50%), radial-gradient(ellipse at 80% 50%, rgba(139,115,85,0.05) 0%, transparent 50%)', pointerEvents: 'none' }} />
            <h2 style={{ fontFamily: 'Playfair Display, serif', color: '#F5E6D3', fontSize: '2.5rem', fontWeight: 600, marginBottom: '1rem', animation: 'slideUp 0.8s ease' }}>Historische Bouwkundige Literatuur</h2>
            <p style={{ color: '#A89070', fontSize: '1rem', maxWidth: '600px', margin: '0 auto 2rem', lineHeight: 1.7, animation: 'slideUp 0.8s ease 0.1s both' }}>
              Ontdek de schatten uit het verleden. Gedigitaliseerde boeken over architectuur, constructie en bouwkunde - vrij toegankelijk voor ingenieurs, architecten en bouwmeesters.
            </p>
            <div className="hero-stats" style={{ display: 'flex', justifyContent: 'center', gap: '3rem', animation: 'slideUp 0.8s ease 0.2s both' }}>
              <div><div style={{ fontFamily: 'Playfair Display, serif', color: '#8B7355', fontSize: '2rem', fontWeight: 600 }}>{booksData.length}</div><div style={{ color: '#6B5344', fontSize: '0.85rem', textTransform: 'uppercase', letterSpacing: '0.1em' }}>Boeken</div></div>
              <div><div style={{ fontFamily: 'Playfair Display, serif', color: '#8B7355', fontSize: '2rem', fontWeight: 600 }}>{totalPages.toLocaleString()}</div><div style={{ color: '#6B5344', fontSize: '0.85rem', textTransform: 'uppercase', letterSpacing: '0.1em' }}>Pagina's</div></div>
              <div><div style={{ fontFamily: 'Playfair Display, serif', color: '#8B7355', fontSize: '2rem', fontWeight: 600 }}>1650-1974</div><div style={{ color: '#6B5344', fontSize: '0.85rem', textTransform: 'uppercase', letterSpacing: '0.1em' }}>Periode</div></div>
            </div>
          </section>

          {/* Categories */}
          <section className="category-filter" style={{ padding: '0 2rem 2rem', display: 'flex', justifyContent: 'center', gap: '0.5rem', flexWrap: 'wrap' }}>
            {categories.map(cat => (
              <a key={cat} href={cat === 'Alle' ? '#' : `#${cat.toLowerCase()}`} onClick={(e) => { e.preventDefault(); handleCategoryChange(cat); }}
                style={{ padding: '0.5rem 1rem', background: category === cat ? 'linear-gradient(135deg, #8B7355 0%, #6B5344 100%)' : 'transparent', border: category === cat ? 'none' : '1px solid rgba(139,115,85,0.3)', borderRadius: '24px', color: category === cat ? '#FFF' : '#A89070', fontFamily: 'DM Sans, sans-serif', fontSize: '0.85rem', fontWeight: 500, cursor: 'pointer', transition: 'all 0.3s', textDecoration: 'none' }}>
                {cat}
              </a>
            ))}
          </section>

          {/* Books Grid */}
          <section className="books-grid" style={{ padding: '1rem 2rem 3rem', display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(280px, 1fr))', gap: '1.5rem', maxWidth: '1400px', margin: '0 auto' }}>
            {filteredBooks.map((book, index) => (
              <BookCard key={book.id} book={{...book, onClick: () => setSelectedBook(book)}} index={index} />
            ))}
          </section>

          {/* Footer */}
          <footer style={{ padding: '2rem', borderTop: '1px solid rgba(139,115,85,0.15)', textAlign: 'center' }}>
            <p style={{ color: '#6B5344', fontSize: '0.85rem' }}>OpenBooks is onderdeel van <a href="https://github.com/OpenAEC-Foundation" target="_blank" rel="noopener" style={{ color: '#8B7355' }}>OpenAEC Foundation</a></p>
            <p style={{ color: '#4A3F32', fontSize: '0.75rem', marginTop: '0.5rem' }}>Deze boeken zijn voor zover te achterhalen vrij van rechten.</p>
          </footer>

          {/* Viewer Modal */}
          {selectedBook && <BookViewer book={selectedBook} onClose={() => setSelectedBook(null)} />}
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
